<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bankly CRM</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #0a0a0f; --bg2: #12121a; --card: #1a1a24; --border: rgba(255,255,255,0.08);
            --text: #fff; --text2: #8b8b9e; --accent: #6366f1;
            --green: #22c55e; --yellow: #f59e0b; --red: #ef4444; --blue: #3b82f6;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 1rem; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--bg2); border-radius: 12px; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem; }
        .logo { font-size: 1.5rem; font-weight: 700; background: linear-gradient(135deg, var(--accent), #a855f7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .status { display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; color: var(--text2); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--green); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1rem; }
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); }
        .card { background: var(--card); border-radius: 12px; border: 1px solid var(--border); padding: 1.25rem; }
        .card-title { font-size: 0.75rem; color: var(--text2); text-transform: uppercase; margin-bottom: 0.75rem; display: flex; justify-content: space-between; align-items: center; }
        .big-num { font-size: 2.25rem; font-weight: 700; background: linear-gradient(135deg, var(--accent), #a855f7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .sub { font-size: 0.85rem; color: var(--text2); margin-top: 0.25rem; }
        .progress-bar { height: 8px; background: var(--bg); border-radius: 4px; margin-top: 0.75rem; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent), #a855f7); border-radius: 4px; }
        .alert { padding: 0.75rem 1rem; border-radius: 8px; margin-bottom: 0.5rem; font-size: 0.85rem; }
        .alert-critical { background: rgba(239,68,68,0.15); border-left: 3px solid var(--red); color: var(--red); }
        .alert-warning { background: rgba(245,158,11,0.15); border-left: 3px solid var(--yellow); color: var(--yellow); }
        .section { margin-bottom: 1.5rem; }
        .section-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; }
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        th, td { padding: 0.6rem; text-align: left; border-bottom: 1px solid var(--border); }
        th { color: var(--text2); font-size: 0.7rem; text-transform: uppercase; font-weight: 500; }
        tr:hover { background: rgba(255,255,255,0.02); }
        .badge { display: inline-block; padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.65rem; font-weight: 600; }
        .badge-hot { background: rgba(239,68,68,0.2); color: var(--red); }
        .badge-warm { background: rgba(245,158,11,0.2); color: var(--yellow); }
        .badge-ok { background: rgba(34,197,94,0.2); color: var(--green); }
        .badge-blue { background: rgba(59,130,246,0.2); color: var(--blue); }
        .tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; overflow-x: auto; }
        .tab { padding: 0.5rem 1rem; background: var(--bg2); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 0.8rem; color: var(--text2); white-space: nowrap; }
        .tab.active { background: var(--accent); color: white; border-color: var(--accent); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .funnel-stage { display: flex; align-items: center; gap: 0.75rem; padding: 0.6rem; background: var(--bg); border-radius: 6px; margin-bottom: 0.5rem; }
        .funnel-name { flex: 1; font-size: 0.85rem; }
        .funnel-count { font-weight: 600; min-width: 35px; }
        .funnel-bar { flex: 2; height: 6px; background: var(--card); border-radius: 3px; overflow: hidden; }
        .funnel-bar-fill { height: 100%; background: var(--accent); }
        .funnel-conv { font-size: 0.7rem; color: var(--text2); min-width: 45px; }
        .provider-card { padding: 0.75rem; background: var(--bg); border-radius: 8px; margin-bottom: 0.5rem; }
        .provider-name { font-weight: 600; margin-bottom: 0.25rem; }
        .provider-meta { font-size: 0.75rem; color: var(--text2); }
        .red-flag { background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3); }
        .insight-item { padding: 0.5rem 0.75rem; background: var(--bg); border-radius: 6px; margin-bottom: 0.5rem; font-size: 0.85rem; border-left: 3px solid var(--accent); }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } .big-num { font-size: 1.8rem; } body { padding: 0.5rem; } .tab { font-size: 0.75rem; padding: 0.4rem 0.75rem; } }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">üè¶ Bankly CRM</div>
        <div class="status"><div class="status-dot"></div><span id="lastUpdate">Loading...</span></div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="showTab('overview')">üìä Overview</div>
        <div class="tab" onclick="showTab('leads')">üî• Leads</div>
        <div class="tab" onclick="showTab('funnel')">üìà Funnel</div>
        <div class="tab" onclick="showTab('groups')">üí¨ Groups</div>
        <div class="tab" onclick="showTab('providers')">üí≥ Providers</div>
        <div class="tab" onclick="showTab('competitors')">üéØ Competitors</div>
        <div class="tab" onclick="showTab('hnwi')">üíé HNWI</div>
        <div class="tab" onclick="showTab('ideas')">üí° Ideas</div>
        <div class="tab" onclick="showTab('alerts')">‚ö†Ô∏è Alerts</div>
    </div>

    <!-- OVERVIEW -->
    <div id="overview" class="tab-content active">
        <div class="grid">
            <div class="card">
                <div class="card-title">Goal Progress</div>
                <div class="big-num"><span id="users">-</span><span style="font-size:1rem;color:var(--text2)">/1000</span></div>
                <div class="sub">Day <span id="day">-</span> of 90</div>
                <div class="progress-bar"><div class="progress-fill" id="goalProgress" style="width:0%"></div></div>
            </div>
            <div class="card">
                <div class="card-title">Velocity</div>
                <div class="big-num" id="velocity">-</div>
                <div class="sub"><span id="actualPace">-</span>/day vs <span id="requiredPace">-</span> required</div>
            </div>
            <div class="card">
                <div class="card-title">Cards</div>
                <div class="big-num" id="cards">-</div>
                <div class="sub"><span id="frozen">-</span> frozen</div>
            </div>
            <div class="card">
                <div class="card-title">Volume</div>
                <div class="big-num">$<span id="volume">-</span></div>
                <div class="sub"><span id="txns">-</span> transactions</div>
            </div>
        </div>
        <div class="grid">
            <div class="card">
                <div class="card-title">Deposits</div>
                <div class="big-num">$<span id="deposits">-</span></div>
            </div>
            <div class="card">
                <div class="card-title">Hot Leads</div>
                <div class="big-num" id="hotLeads">-</div>
                <div class="sub"><span id="warmLeads">-</span> warm ¬∑ <span id="converted">-</span> converted</div>
            </div>
            <div class="card">
                <div class="card-title">HNWI Contacts</div>
                <div class="big-num"><span id="hnwi">-</span><span style="font-size:1rem;color:var(--text2)">/500</span></div>
                <div class="progress-bar"><div class="progress-fill" id="hnwiProgress" style="width:0%"></div></div>
            </div>
            <div class="card">
                <div class="card-title">TG Groups</div>
                <div class="big-num" id="activeGroups">-</div>
                <div class="sub"><span id="forbiddenGroups">-</span> forbidden</div>
            </div>
        </div>
        <div class="section">
            <div class="section-title">‚ö†Ô∏è Active Alerts</div>
            <div id="alertsOverview"></div>
        </div>
    </div>

    <!-- LEADS -->
    <div id="leads" class="tab-content">
        <div class="card">
            <div class="card-title">Lead Pipeline <span class="badge badge-hot" id="leadStats">-</span></div>
            <table>
                <thead><tr><th>Lead</th><th>Platform</th><th>Topic</th><th>Status</th><th>Days</th></tr></thead>
                <tbody id="leadsTable"></tbody>
            </table>
        </div>
    </div>

    <!-- FUNNEL -->
    <div id="funnel" class="tab-content">
        <div class="card">
            <div class="card-title">Conversion Funnel (30d)</div>
            <div id="funnelChart"></div>
        </div>
    </div>

    <!-- GROUPS -->
    <div id="groups" class="tab-content">
        <div class="card">
            <div class="card-title">Telegram Groups</div>
            <table>
                <thead><tr><th>Group</th><th>Language</th><th>Status</th></tr></thead>
                <tbody id="groupsTable"></tbody>
            </table>
        </div>
    </div>

    <!-- PROVIDERS -->
    <div id="providers" class="tab-content">
        <div class="grid grid-2">
            <div class="card">
                <div class="card-title">‚úÖ Verified Providers</div>
                <div id="verifiedProviders"></div>
            </div>
            <div class="card">
                <div class="card-title">üè∑Ô∏è White-Label Options</div>
                <div id="whiteLabelProviders"></div>
            </div>
        </div>
        <div class="grid grid-2">
            <div class="card">
                <div class="card-title">üè¶ BIN Sponsors (Europe)</div>
                <div id="binSponsors"></div>
            </div>
            <div class="card">
                <div class="card-title">üî¥ Red Flags ‚Äî DO NOT USE</div>
                <div id="redFlagProviders"></div>
            </div>
        </div>
    </div>

    <!-- COMPETITORS -->
    <div id="competitors" class="tab-content">
        <div class="card">
            <div class="card-title">Competitor Analysis</div>
            <table>
                <thead><tr><th>Name</th><th>Telegram</th><th>Instagram</th><th>Twitter</th><th>Strength</th></tr></thead>
                <tbody id="competitorsTable"></tbody>
            </table>
        </div>
        <div class="card" style="margin-top:1rem">
            <div class="card-title">Key Insights</div>
            <div id="competitorInsights"></div>
        </div>
    </div>

    <!-- HNWI -->
    <div id="hnwi" class="tab-content">
        <div class="grid">
            <div class="card">
                <div class="card-title">Progress</div>
                <div class="big-num"><span id="hnwiTotal">-</span><span style="font-size:1rem;color:var(--text2)">/500</span></div>
                <div class="progress-bar"><div class="progress-fill" id="hnwiProgressBar" style="width:0%"></div></div>
            </div>
            <div class="card">
                <div class="card-title">Segments</div>
                <div id="hnwiSegments"></div>
            </div>
        </div>
        <div class="card" style="margin-top:1rem">
            <div class="card-title">Sample Contacts</div>
            <table>
                <thead><tr><th>Company</th><th>Location</th><th>Phone</th><th>Type</th></tr></thead>
                <tbody id="hnwiContacts"></tbody>
            </table>
        </div>
    </div>

    <!-- IDEAS -->
    <div id="ideas" class="tab-content">
        <div class="card">
            <div class="card-title">Top 3 Startup Ideas</div>
            <div id="topIdeas"></div>
        </div>
        <div class="card" style="margin-top:1rem">
            <div class="card-title">Full Report</div>
            <p style="color:var(--text2);font-size:0.85rem">See <code>memory/BUSINESS_IDEAS.md</code> for detailed analysis (74KB)</p>
        </div>
    </div>

    <!-- ALERTS -->
    <div id="alerts" class="tab-content">
        <div class="card">
            <div class="card-title">All Alerts</div>
            <div id="allAlerts"></div>
        </div>
        <div class="card" style="margin-top:1rem">
            <div class="card-title">Outreach Status</div>
            <div id="outreachStatus"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://mybankly.org/api/system';
        const API_KEY = 'sk-bankly-ce015eb6b293534a266c9003e829a7f68ce7249f7be12cff14c61805c359c1b6';
        const DATA_URL = 'https://banklycc-alt.github.io/bankly-crm/data.json';
        
        let data = null;

        function showTab(name) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(name).classList.add('active');
        }

        async function fetchAPI(endpoint) {
            try {
                const res = await fetch(`${API_BASE}${endpoint}`, { headers: { 'Authorization': `Bearer ${API_KEY}` } });
                return await res.json();
            } catch (e) { console.error('API:', e); return null; }
        }

        async function fetchData() {
            try {
                const res = await fetch(DATA_URL + '?t=' + Date.now());
                if (res.ok) data = await res.json();
            } catch (e) { console.log('Data fetch error'); }

            const status = await fetchAPI('/status');
            const funnel = await fetchAPI('/funnel');
            
            if (status?.success) updateOverview(status, funnel);
            if (data) {
                updateLeads(); updateGroups(); updateAlerts(); updateProviders();
                updateCompetitors(); updateHNWI(); updateIdeas();
            }
            if (funnel?.success) updateFunnel(funnel.stages);
            document.getElementById('lastUpdate').textContent = 'Updated ' + new Date().toLocaleTimeString();
        }

        function updateOverview(status, funnel) {
            const db = status.database;
            const day = Math.ceil((Date.now() - new Date('2026-02-01').getTime()) / (1000*60*60*24));
            const users = db.users.total;
            const requiredPace = ((1000 - users) / (90 - day)).toFixed(1);
            const actualPace = (users / day).toFixed(1);
            const velocity = (actualPace / requiredPace).toFixed(2);

            document.getElementById('users').textContent = users;
            document.getElementById('day').textContent = day;
            document.getElementById('goalProgress').style.width = (users/10) + '%';
            document.getElementById('velocity').textContent = velocity + 'x';
            document.getElementById('velocity').style.color = velocity < 0.5 ? 'var(--red)' : velocity < 1 ? 'var(--yellow)' : 'var(--green)';
            document.getElementById('actualPace').textContent = actualPace;
            document.getElementById('requiredPace').textContent = requiredPace;
            document.getElementById('cards').textContent = db.cards.active;
            document.getElementById('frozen').textContent = db.cards.frozen;
            document.getElementById('volume').textContent = Math.round(db.deposits.totalVolume/1000) + 'K';
            document.getElementById('txns').textContent = db.transactions.total;
            document.getElementById('deposits').textContent = Math.round(db.deposits.confirmedVolume/1000) + 'K';
            
            if (data) {
                document.getElementById('hotLeads').textContent = data.leads?.hot || '-';
                document.getElementById('warmLeads').textContent = data.leads?.warm || '-';
                document.getElementById('converted').textContent = data.leads?.converted || '0';
                document.getElementById('hnwi').textContent = data.hnwi?.total || '-';
                document.getElementById('hnwiProgress').style.width = ((data.hnwi?.total || 0) / 5) + '%';
                document.getElementById('activeGroups').textContent = data.groups?.active || '-';
                document.getElementById('forbiddenGroups').textContent = data.groups?.forbidden || '-';
            }
        }

        function updateLeads() {
            if (!data?.leads?.list) return;
            document.getElementById('leadStats').textContent = `${data.leads.hot} hot ¬∑ ${data.leads.warm} warm`;
            document.getElementById('leadsTable').innerHTML = data.leads.list.map(l => `
                <tr><td><strong>${l.name}</strong></td><td>${l.platform}</td><td>${l.topic}</td>
                <td><span class="badge badge-${l.status === 'replied' ? 'ok' : l.status === 'cta_sent' ? 'blue' : 'warm'}">${l.status}</span></td>
                <td>${l.days}d</td></tr>
            `).join('');
        }

        function updateFunnel(stages) {
            if (!stages) return;
            const max = Math.max(...stages.map(s => s.count));
            document.getElementById('funnelChart').innerHTML = stages.map(s => `
                <div class="funnel-stage"><div class="funnel-name">${s.stage.replace(/_/g, ' ')}</div>
                <div class="funnel-count">${s.count}</div>
                <div class="funnel-bar"><div class="funnel-bar-fill" style="width:${(s.count/max*100)}%"></div></div>
                <div class="funnel-conv">${s.conversion || ''}</div></div>
            `).join('');
        }

        function updateGroups() {
            if (!data?.groups?.list) return;
            document.getElementById('groupsTable').innerHTML = data.groups.list.map(g => `
                <tr><td>${g.name}</td><td>${g.lang}</td>
                <td><span class="badge badge-${g.status === 'best' || g.status === 'hot' ? 'hot' : g.status === 'active' || g.status === 'ok' ? 'ok' : 'warm'}">${g.status}</span></td></tr>
            `).join('');
        }

        function updateAlerts() {
            if (!data?.alerts) return;
            const html = data.alerts.map(a => `<div class="alert alert-${a.type}">${a.message}</div>`).join('');
            document.getElementById('alertsOverview').innerHTML = html;
            document.getElementById('allAlerts').innerHTML = html;
            
            if (data.outreach) {
                document.getElementById('outreachStatus').innerHTML = `
                    <div class="alert alert-${data.outreach.status === 'blocked' ? 'critical' : 'warning'}">
                        Status: <strong>${data.outreach.status.toUpperCase()}</strong> ‚Äî ${data.outreach.blocker || 'OK'}<br>
                        Emails ready: ${data.outreach.emailsReady} ¬∑ HNWI queue: ${data.outreach.hnwiQueue} ¬∑ Follow-ups due: ${data.outreach.followUpsDue}
                    </div>`;
            }
        }

        function updateProviders() {
            if (!data?.providers) return;
            document.getElementById('verifiedProviders').innerHTML = data.providers.verified.map(p => `
                <div class="provider-card"><div class="provider-name">${p.name}</div>
                <div class="provider-meta">${p.type} ¬∑ ${p.region} ¬∑ ${p.funding || ''} ¬∑ ${p.notes}</div></div>
            `).join('');
            document.getElementById('whiteLabelProviders').innerHTML = data.providers.whiteLabel.map(p => `
                <div class="provider-card"><div class="provider-name">${p.name}</div>
                <div class="provider-meta">${p.service} ¬∑ ${p.pricing}</div></div>
            `).join('');
            document.getElementById('binSponsors').innerHTML = data.providers.binSponsors.map(p => `
                <div class="provider-card"><div class="provider-name">${p.name}</div>
                <div class="provider-meta">${p.region} ¬∑ ${p.cards}</div></div>
            `).join('');
            document.getElementById('redFlagProviders').innerHTML = data.providers.redFlags.map(p => `
                <div class="provider-card red-flag"><div class="provider-name">üî¥ ${p.name}</div>
                <div class="provider-meta">${p.reason}</div></div>
            `).join('');
        }

        function updateCompetitors() {
            if (!data?.competitors) return;
            document.getElementById('competitorsTable').innerHTML = data.competitors.list.map(c => `
                <tr><td><strong>${c.name}</strong></td><td>${c.tg}</td><td>${c.ig}</td><td>${c.twitter}</td><td>${c.strength}</td></tr>
            `).join('');
            document.getElementById('competitorInsights').innerHTML = data.competitors.insights.map(i => `
                <div class="insight-item">${i}</div>
            `).join('');
        }

        function updateHNWI() {
            if (!data?.hnwi) return;
            document.getElementById('hnwiTotal').textContent = data.hnwi.total;
            document.getElementById('hnwiProgressBar').style.width = (data.hnwi.total / 5) + '%';
            document.getElementById('hnwiSegments').innerHTML = data.hnwi.segments.map(s => `
                <div style="display:flex;justify-content:space-between;padding:0.5rem 0;border-bottom:1px solid var(--border)">
                    <span>${s.name}</span>
                    <span><strong>${s.count}</strong> <span class="badge badge-${s.status === 'active' ? 'ok' : s.status === 'next' ? 'blue' : 'warm'}">${s.status}</span></span>
                </div>
            `).join('');
            document.getElementById('hnwiContacts').innerHTML = data.hnwi.contacts.slice(0,8).map(c => `
                <tr><td>${c.company}</td><td>${c.location}</td><td>${c.phone}</td><td>${c.type}</td></tr>
            `).join('');
        }

        function updateIdeas() {
            if (!data?.businessIdeas) return;
            document.getElementById('topIdeas').innerHTML = data.businessIdeas.top3.map((idea, i) => `
                <div class="provider-card">
                    <div class="provider-name">#${i+1} ${idea.name} <span class="badge badge-ok">${idea.score}</span></div>
                    <div class="provider-meta">TAM: ${idea.tam} ¬∑ ${idea.notes}</div>
                </div>
            `).join('');
        }

        fetchData();
        setInterval(fetchData, 5 * 60 * 1000);
    </script>
</body>
</html>
